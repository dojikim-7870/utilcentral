<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community | UtilCentral</title>
  <meta name="description" content="Join the UtilCentral Community. Discuss tools, suggest improvements, and connect with other users.">
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDK -->
  <script defer src="/__/firebase/12.5.0/firebase-app-compat.js"></script>
  <script defer src="/__/firebase/12.5.0/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/12.5.0/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/init.js"></script>

  <style>
    /* Í≤åÏãúÌåê Ï†ÑÏö© Ïä§ÌÉÄÏùº */
    #community-header { max-width:900px; margin: 20px auto; padding:0 15px; }
    .board-tabs { display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap; }
    .board-tabs button { padding:10px 16px; border:none; border-radius:5px; background:#e0e0e0; cursor:pointer; transition:0.3s; }
    .board-tabs button.active { background:#039be5; color:white; }
    .login-buttons { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
    .login-buttons button { flex:1; min-width:120px; padding:10px; border:none; border-radius:5px; cursor:pointer; color:white; font-weight:600; }
    .login-google{background:#DB4437;} .login-facebook{background:#4267B2;}
    .login-twitter{background:#1DA1F2;} .login-microsoft{background:#F25022;}
    .login-apple{background:#000000;}
    .post-card { background:white; padding:20px; border-radius:8px; margin-bottom:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .post-card h4 { margin:0 0 5px; }
    .post-card p { margin:0 0 10px; }
    .comments { margin-top:10px; padding-left:15px; border-left:2px solid #eee; }
    .comment { margin-bottom:10px; }
    .reply { margin-left:15px; border-left:1px dashed #ccc; padding-left:10px; }
    .new-post { margin-bottom:20px; }
    .new-post textarea { width:100%; min-height:60px; padding:10px; border-radius:5px; border:1px solid #ccc; resize:none; }
    .new-post button { margin-top:10px; padding:8px 16px; border:none; border-radius:5px; background:#039be5; color:white; cursor:pointer; }
    .comment-reply { font-size:0.9em; color:#555; cursor:pointer; margin-left:5px; }
  </style>
</head>
<body>
  <header>
    <div class="logo"><a href="index.html">UtilCentral</a></div>
    <button class="hamburger-menu" id="hamburger">&#9776;</button>
    <nav class="main-nav" id="main-nav">
      <a href="index.html">üõ†Ô∏è Utilities</a>
      <a href="community.html" class="active">üí¨ Community</a>
      <a href="request.html">üí° Request/Suggest</a>
      <a href="advertise.html" class="partner-btn">üåü Partner/Advertise</a>
    </nav>
  </header>

  <div id="community-header">
    <h1>UtilCentral Community</h1>
    <p>Discuss tools, share ideas, and connect with other users.</p>

    <!-- Î°úÍ∑∏Ïù∏ Î≤ÑÌäº -->
    <div class="login-buttons" id="login-buttons">
      <button class="login-google" onclick="login('google')">Google</button>
      <button class="login-facebook" onclick="login('facebook')">Facebook</button>
      <button class="login-twitter" onclick="login('twitter')">Twitter</button>
      <button class="login-microsoft" onclick="login('microsoft')">Microsoft</button>
      <button class="login-apple" onclick="login('apple')">Apple</button>
    </div>

    <!-- Í≤åÏãúÌåê Î©îÎâ¥ -->
    <div class="board-tabs">
      <button class="tab-btn active" data-board="notice">Í≥µÏßÄ</button>
      <button class="tab-btn" data-board="general">ÏûêÏú†Í≤åÏãúÌåê</button>
      <button class="tab-btn" data-board="request">Q&A / Ï†úÏïà</button>
      <button class="tab-btn" data-board="partner">Ï∂îÏ≤ú / ÌôçÎ≥¥</button>
    </div>
  </div>

  <main id="community-main" style="max-width:900px;margin:0 auto;padding:0 15px;">
    <div class="new-post" id="new-post" style="display:none;">
      <textarea id="post-content" placeholder="Write your post..."></textarea>
      <button onclick="submitPost()">Post</button>
    </div>

    <div id="posts-container"></div>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>UtilCentral</h4>
        <p>Your ultimate collection of free, fast, and essential online web utilities. Built for efficiency.</p>
      </div>
      <div class="footer-section">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="https://imagetool.info">ImageTool</a></li>
          <li><a href="https://fixlo.info">Fixlo</a></li>
          <li><a href="https://solvekit.info">Solvekit</a></li>
          <li><a href="https://financetools.info">FinanceTools</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Legal & Support</h4>
        <ul>
          <li><a href="privacy.html">Privacy Policy</a></li>
          <li><a href="terms.html">Terms of Service</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li><a href="about.html">About Us</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Resources</h4>
        <ul>
          <li><a href="blog.html">Blog & Tutorials</a></li>
          <li><a href="faq.html">FAQ</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 UtilCentral. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    const db = firebase.firestore();
    let user = null;

    // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
    function login(providerName){
      let provider;
      switch(providerName){
        case 'google': provider = new firebase.auth.GoogleAuthProvider(); break;
        case 'facebook': provider = new firebase.auth.FacebookAuthProvider(); break;
        case 'twitter': provider = new firebase.auth.TwitterAuthProvider(); break;
        case 'microsoft': provider = new firebase.auth.OAuthProvider('microsoft.com'); break;
        case 'apple': provider = new firebase.auth.OAuthProvider('apple.com'); break;
      }
      firebase.auth().signInWithPopup(provider)
        .then(result => {
          user = result.user;
          document.getElementById('new-post').style.display = 'block';
          document.getElementById('login-buttons').style.display = 'none';
        })
        .catch(console.error);
    }

    // Í≤åÏãúÌåê ÌÉ≠ ÌïÑÌÑ∞
    const tabBtns = document.querySelectorAll('.tab-btn');
    let currentBoard = 'notice';
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        tabBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        currentBoard = btn.dataset.board;
        loadPosts(currentBoard);
      });
    });

    // Í∏ÄÏì∞Í∏∞
    function submitPost(){
      const content = document.getElementById('post-content').value.trim();
      if(!user || !content) return alert('Please login and write content.');
      db.collection('boards').doc(currentBoard).collection('posts').add({
        author: user.displayName || 'Anonymous',
        content: content,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        comments: []
      }).then(() => {
        document.getElementById('post-content').value='';
      });
    }

    // ÎåìÍ∏Ä ÏûëÏÑ±
    function addComment(postId, text, parentId=null){
      const postRef = db.collection('boards').doc(currentBoard).collection('posts').doc(postId);
      if(parentId){
        postRef.update({
          comments: firebase.firestore.FieldValue.arrayUnion({author:user.displayName, content:text, timestamp:firebase.firestore.FieldValue.serverTimestamp(), replies:[], parentId})
        });
      } else {
        postRef.update({
          comments: firebase.firestore.FieldValue.arrayUnion({author:user.displayName, content:text, timestamp:firebase.firestore.FieldValue.serverTimestamp(), replies:[]})
        });
      }
    }

    // Í≤åÏãúÍ∏Ä Ïã§ÏãúÍ∞Ñ Î°úÎìú
    function loadPosts(board){
      const container = document.getElementById('posts-container');
      container.innerHTML='';
      db.collection('boards').doc(board).collection('posts').orderBy('timestamp','desc')
        .onSnapshot(snapshot=>{
          container.innerHTML='';
          snapshot.forEach(doc=>{
            const post = doc.data();
            const postCard = document.createElement('div');
            postCard.className='post-card';
            postCard.innerHTML = `
              <h4>${post.author}</h4>
              <p>${post.content}</p>
              <div class="comments" id="comments-${doc.id}"></div>
              ${user ? `<textarea id="comment-input-${doc.id}" placeholder="Write a comment..."></textarea>
              <button onclick="submitComment('${doc.id}')">Comment</button>` : ''}
            `;
            container.appendChild(postCard);

            // ÎåìÍ∏Ä Î†åÎçîÎßÅ
            const commentsContainer = document.getElementById(`comments-${doc.id}`);
            post.comments.forEach(c=>{
              const div = document.createElement('div');
              div.className='comment';
              div.innerHTML=`<strong>${c.author}:</strong> ${c.content}`;
              commentsContainer.appendChild(div);
              if(c.replies){
                c.replies.forEach(r=>{
                  const rdiv=document.createElement('div');
                  rdiv.className='comment reply';
                  rdiv.innerHTML=`<strong>${r.author}:</strong> ${r.content}`;
                  commentsContainer.appendChild(rdiv);
                });
              }
            });
          });
        });
    }

    // ÎåìÍ∏Ä Ï†úÏ∂ú
    function submitComment(postId){
      const text = document.getElementById(`comment-input-${postId}`).value.trim();
      if(!text) return;
      addComment(postId, text);
      document.getElementById(`comment-input-${postId}`).value='';
    }

    // Ï¥àÍ∏∞ load
    loadPosts(currentBoard);
  </script>
</body>
</html>
